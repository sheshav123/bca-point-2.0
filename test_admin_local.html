<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BCA Point Admin - Local Test</title>
    <link rel="stylesheet" href="admin_panel/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“š BCA Point 2.0 Admin Panel (Local Test)</h1>
            <button id="logoutBtn" class="btn btn-danger" style="display: none;">Logout</button>
        </header>

        <div id="loginSection" class="section">
            <div class="card">
                <h2>Admin Login</h2>
                <form id="passwordLoginForm">
                    <input type="password" id="adminPassword" placeholder="Enter Admin Password" required>
                    <button type="submit" class="btn btn-primary">Login</button>
                </form>
            </div>
        </div>

        <div id="adminSection" style="display: none;">
            <div class="tabs">
                <button class="tab-btn active" data-tab="categories">Categories</button>
                <button class="tab-btn" data-tab="notifications">ðŸ“¢ Notifications</button>
            </div>

            <div id="categories" class="tab-content active">
                <div class="card">
                    <h2>Existing Categories</h2>
                    <div id="categoriesList"></div>
                </div>
            </div>

            <div id="notifications" class="tab-content">
                <div class="card">
                    <h2>ðŸ“¢ Send In-App Notification</h2>
                    <form id="notificationForm">
                        <label style="font-weight: 600; margin-bottom: 5px; display: block;">Notification Type</label>
                        <select id="notificationType" required style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; width: 100%; margin-bottom: 15px;">
                            <option value="">Select Type</option>
                            <option value="new_category">ðŸ†• New Category Added</option>
                            <option value="new_material">ðŸ“„ New Material Added</option>
                            <option value="premium">ðŸ‘‘ Join Premium</option>
                            <option value="announcement">ðŸ“£ General Announcement</option>
                            <option value="update">ðŸ”„ App Update</option>
                        </select>
                        
                        <label style="font-weight: 600; margin-bottom: 5px; display: block;">Title</label>
                        <input type="text" id="notificationTitle" placeholder="Notification Title" required maxlength="50" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; width: 100%; margin-bottom: 15px;">
                        
                        <label style="font-weight: 600; margin-bottom: 5px; display: block;">Message</label>
                        <textarea id="notificationMessage" placeholder="Notification message" required maxlength="200" rows="3" style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; width: 100%; margin-bottom: 15px; resize: vertical;"></textarea>
                        
                        <label style="font-weight: 600; margin-bottom: 5px; display: block;">Target Audience</label>
                        <select id="notificationAudience" required style="padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; width: 100%; margin-bottom: 15px;">
                            <option value="all">All Users</option>
                            <option value="free">Free Users Only</option>
                            <option value="premium">Premium Users Only</option>
                        </select>
                        
                        <button type="submit" style="padding: 12px 24px; background: #667eea; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%;">ðŸ“¤ Send Notification</button>
                    </form>
                </div>
                
                <div class="card">
                    <h2>Recent Notifications</h2>
                    <div id="notificationsList"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, updateDoc, addDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDbGQvEoVsBqLYiiYsy_5JD3Xz6TUKIq0c",
            authDomain: "bca-point-2.firebaseapp.com",
            projectId: "bca-point-2",
            storageBucket: "bca-point-2.firebasestorage.app",
            messagingSenderId: "172385715450",
            appId: "1:172385715450:web:d87c9818b5990e82b0b543",
            measurementId: "G-HNGS5B7N9Y"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const ADMIN_PASSWORD = 'admin123';

        document.addEventListener('DOMContentLoaded', () => {
            const loginSection = document.getElementById('loginSection');
            const adminSection = document.getElementById('adminSection');
            const passwordLoginForm = document.getElementById('passwordLoginForm');
            const logoutBtn = document.getElementById('logoutBtn');

            if (sessionStorage.getItem('adminLoggedIn') === 'true') {
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                logoutBtn.style.display = 'block';
                loadCategories();
            }

            passwordLoginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const password = document.getElementById('adminPassword').value;
                
                if (password === ADMIN_PASSWORD) {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    loginSection.style.display = 'none';
                    adminSection.style.display = 'block';
                    logoutBtn.style.display = 'block';
                    loadCategories();
                } else {
                    alert('Incorrect password!');
                }
            });

            logoutBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    sessionStorage.removeItem('adminLoggedIn');
                    loginSection.style.display = 'flex';
                    adminSection.style.display = 'none';
                    logoutBtn.style.display = 'none';
                }
            });

            // Tab Navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabName = btn.dataset.tab;
                    
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    btn.classList.add('active');
                    document.getElementById(tabName).classList.add('active');
                    
                    if (tabName === 'notifications') {
                        loadNotifications();
                    }
                });
            });

            // Notifications
            document.getElementById('notificationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const type = document.getElementById('notificationType').value;
                const title = document.getElementById('notificationTitle').value;
                const message = document.getElementById('notificationMessage').value;
                const audience = document.getElementById('notificationAudience').value;
                
                try {
                    await addDoc(collection(db, 'notifications'), {
                        type,
                        title,
                        message,
                        audience,
                        createdAt: new Date().toISOString(),
                        read: false
                    });
                    
                    alert('ðŸ“¢ Notification sent successfully!\n\nCheck your app now!');
                    e.target.reset();
                    loadNotifications();
                } catch (error) {
                    alert('Error sending notification: ' + error.message);
                }
            });
        });

        async function loadNotifications() {
            const q = query(collection(db, 'notifications'), orderBy('createdAt', 'desc'));
            const snapshot = await getDocs(q);
            
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = '';
            
            if (snapshot.empty) {
                notificationsList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No notifications sent yet</p>';
                return;
            }
            
            snapshot.forEach((doc) => {
                const data = doc.data();
                const date = new Date(data.createdAt).toLocaleString();
                
                const typeIcons = {
                    'new_category': 'ðŸ†•',
                    'new_material': 'ðŸ“„',
                    'premium': 'ðŸ‘‘',
                    'announcement': 'ðŸ“£',
                    'update': 'ðŸ”„'
                };
                
                const audienceLabels = {
                    'all': 'All Users',
                    'free': 'Free Users',
                    'premium': 'Premium Users'
                };
                
                const item = document.createElement('div');
                item.style.cssText = 'padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px;';
                item.innerHTML = `
                    <h3 style="margin: 0 0 5px 0;">${typeIcons[data.type] || 'ðŸ“¢'} ${data.title}</h3>
                    <p style="margin: 5px 0; color: #666;">${data.message}</p>
                    <p style="font-size: 12px; color: #999; margin: 5px 0 0 0;">
                        ðŸ‘¥ ${audienceLabels[data.audience]} â€¢ ðŸ“… ${date}
                    </p>
                `;
                notificationsList.appendChild(item);
            });
        }

        async function loadCategories() {
            const q = query(collection(db, 'categories'), orderBy('order'));
            const snapshot = await getDocs(q);
            
            const categoriesList = document.getElementById('categoriesList');
            categoriesList.innerHTML = '';
            
            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                const isPremium = data.isPremium || false;
                
                const item = document.createElement('div');
                item.className = 'item';
                item.style.borderLeft = isPremium ? '4px solid #ffc107' : '';
                item.innerHTML = `
                    <div class="item-info">
                        <h3>
                            ${isPremium ? '<span style="color: #ffc107; margin-right: 8px;">ðŸ‘‘</span>' : ''}
                            ${data.title}
                            ${isPremium ? '<span style="background: linear-gradient(135deg, #ffc107, #ff9800); color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; margin-left: 8px; font-weight: bold;">PREMIUM</span>' : ''}
                        </h3>
                        <p>${data.description || 'No description'} â€¢ Order: ${data.order}</p>
                    </div>
                    <div class="item-actions" style="display: flex; align-items: center; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <span style="font-size: 12px; font-weight: bold; color: #666;">Premium:</span>
                            <label class="toggle-switch">
                                <input type="checkbox" ${isPremium ? 'checked' : ''} onchange="togglePremiumStatus('${docSnap.id}', this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>
                    </div>
                `;
                categoriesList.appendChild(item);
            });
        }

        window.togglePremiumStatus = async (id, isPremium) => {
            try {
                await updateDoc(doc(db, 'categories', id), {
                    isPremium: isPremium
                });
                alert(isPremium ? 'ðŸ‘‘ Category is now PREMIUM!' : 'Category is now FREE');
                loadCategories();
            } catch (error) {
                alert('Error updating premium status: ' + error.message);
            }
        };
    </script>
</body>
</html>
