<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Notifications</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .success { background: #4CAF50; color: white; }
        .error { background: #f44336; color: white; }
        #output {
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîî Test Notifications System</h1>
    
    <button class="success" onclick="sendTestNotification()">Send Test Notification</button>
    <button onclick="checkNotifications()">Check Notifications in Firestore</button>
    <button onclick="checkRules()">Test Firestore Rules</button>
    
    <div id="output"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDbGQvEoVsBqLYiiYsy_5JD3Xz6TUKIq0c",
            authDomain: "bca-point-2.firebaseapp.com",
            projectId: "bca-point-2",
            storageBucket: "bca-point-2.firebasestorage.app",
            messagingSenderId: "172385715450",
            appId: "1:172385715450:web:d87c9818b5990e82b0b543",
            measurementId: "G-HNGS5B7N9Y"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const output = document.getElementById('output');

        window.sendTestNotification = async function() {
            output.textContent = 'Sending test notification...';
            try {
                const docRef = await addDoc(collection(db, 'notifications'), {
                    type: 'announcement',
                    title: 'Test Notification',
                    message: 'This is a test notification sent at ' + new Date().toLocaleTimeString(),
                    audience: 'all',
                    createdAt: new Date().toISOString(),
                    read: false
                });
                output.textContent = '‚úÖ SUCCESS!\n\nNotification sent with ID: ' + docRef.id + '\n\nNow check your app!';
            } catch (error) {
                output.textContent = '‚ùå ERROR:\n\n' + error.message + '\n\n' + error.stack;
            }
        };

        window.checkNotifications = async function() {
            output.textContent = 'Checking notifications in Firestore...';
            try {
                const q = query(collection(db, 'notifications'), orderBy('createdAt', 'desc'));
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    output.textContent = '‚ö†Ô∏è No notifications found in Firestore.\n\nTry sending one first!';
                    return;
                }
                
                let result = `‚úÖ Found ${snapshot.size} notifications:\n\n`;
                snapshot.forEach((doc, index) => {
                    const data = doc.data();
                    result += `${index + 1}. ${data.title}\n`;
                    result += `   Type: ${data.type}\n`;
                    result += `   Message: ${data.message}\n`;
                    result += `   Audience: ${data.audience}\n`;
                    result += `   Created: ${data.createdAt}\n`;
                    result += `   Read: ${data.read}\n\n`;
                });
                output.textContent = result;
            } catch (error) {
                output.textContent = '‚ùå ERROR:\n\n' + error.message;
            }
        };

        window.checkRules = async function() {
            output.textContent = 'Testing Firestore rules...';
            try {
                // Try to read
                const q = query(collection(db, 'notifications'));
                const snapshot = await getDocs(q);
                output.textContent = '‚úÖ READ ACCESS: OK\n\n';
                
                // Try to write
                try {
                    await addDoc(collection(db, 'notifications'), {
                        type: 'test',
                        title: 'Rule Test',
                        message: 'Testing write access',
                        audience: 'all',
                        createdAt: new Date().toISOString(),
                        read: false
                    });
                    output.textContent += '‚úÖ WRITE ACCESS: OK\n\n';
                    output.textContent += 'Firestore rules are configured correctly!';
                } catch (writeError) {
                    output.textContent += '‚ùå WRITE ACCESS: DENIED\n\n';
                    output.textContent += 'Error: ' + writeError.message + '\n\n';
                    output.textContent += 'You need to update Firestore rules in Firebase Console!';
                }
            } catch (error) {
                output.textContent = '‚ùå ERROR:\n\n' + error.message;
            }
        };

        // Auto-check on load
        checkNotifications();
    </script>
</body>
</html>
